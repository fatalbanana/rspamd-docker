commit 65c3e586d5e3228e778f9587033d987d43e0374a
Author: Andrew Lewis <nerf@judo.za.org>
Date:   Mon Nov 13 16:19:06 2023 +0200

    [Test] Set umask where it's useful

diff --git a/.drone.jsonnet b/.drone.jsonnet
index ef0f56c61..8bac34da6 100644
--- a/.drone.jsonnet
+++ b/.drone.jsonnet
@@ -192,7 +192,6 @@ local pipeline(arch) = {
         'cd /rspamd/build',
         'ulimit -c unlimited',
         'ulimit -s unlimited',
-        'umask 0000',
         'set +e',
         'RSPAMD_INSTALLROOT=/rspamd/install robot --removekeywords wuks --exclude isbroken $DRONE_WORKSPACE/test/functional/cases; EXIT_CODE=$?',
         'set -e',
diff --git a/.drone.yml b/.drone.yml
index 196dbf9ad..9e5c3409e 100644
--- a/.drone.yml
+++ b/.drone.yml
@@ -136,7 +136,6 @@
             "cd /rspamd/build",
             "ulimit -c unlimited",
             "ulimit -s unlimited",
-            "umask 0000",
             "set +e",
             "RSPAMD_INSTALLROOT=/rspamd/install robot --removekeywords wuks --exclude isbroken $DRONE_WORKSPACE/test/functional/cases; EXIT_CODE=$?",
             "set -e",
@@ -353,7 +352,6 @@
             "cd /rspamd/build",
             "ulimit -c unlimited",
             "ulimit -s unlimited",
-            "umask 0000",
             "set +e",
             "RSPAMD_INSTALLROOT=/rspamd/install robot --removekeywords wuks --exclude isbroken $DRONE_WORKSPACE/test/functional/cases; EXIT_CODE=$?",
             "set -e",
@@ -561,7 +559,7 @@
 }
 ---
 {
-   "hmac": "6c89d1423ccbddbfac9e2b67f24192018670209a293cfee308880a16a2f2b372",
+   "hmac": "1fb0cd2235d6c518d809751b4b263601285c5554863c89c19bd325af38207bce",
    "kind": "signature"
 }
 ...
diff --git a/test/functional/util/dummy_p0f.py b/test/functional/util/dummy_p0f.py
index 2bcd183d4..1d86ba0ca 100755
--- a/test/functional/util/dummy_p0f.py
+++ b/test/functional/util/dummy_p0f.py
@@ -66,6 +66,8 @@ if __name__ == "__main__":
     p0f_status = 'ok'
     p0f_os = 'linux'
 
+    os.umask(0000)
+
     alen = len(sys.argv)
     if alen > 1:
         SOCK = sys.argv[1]
